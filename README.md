# API Documentation for Clothing Store App

## Task
Create an online clothing store where customers can search for specific clothing items in their size. The system should provide a list of available products matching the search criteria.

## Table of Contents

- [Authentication](#authentication)
- [`api/v1/users`](#apiv1users-)
  - [`GET api/v1/users`](#get-apiv1users)
  - [`GET api/v1/users/:userId`](#get-apiv1usersuserId)
  - [`PUT api/v1/users/:userId`](#put-apiv1usersuserId)
  - [`POST api/v1/users/register`](#post-apiv1usersregister)
  - [`POST api/v1/users/login`](#post-apiv1userslogin)
  - [`DELETE api/v1/users/:userId`](#delete-apiv1usersuserId)
- [`api/v1/products`](#apiv1products-)
  - [`GET api/v1/products`](#get-apiv1products)
  - [`GET api/v1/products/:productId`](#get-apiv1productsproductId)
  - [`PUT api/v1/products/:productId`](#put-apiv1productsproductId)
  - [`POST api/v1/products`](#post-apiv1products)
  - [`DELETE api/v1/products/:productId`](#delete-apiv1productsproductId)
- [`api/v1/products/:productId/options`](#-apiv1productsproductIdoptions-)
  - [`POST api/v1/products/:productId/options`](#post-apiv1productsproductIdoptions)
  - [`DELETE api/v1/products/:productId/options/:color`](#delete-apiv1/productsproductIdoptionscolor)
- [`api/v1/carts`](#apiv1carts-)
  - [`POST api/v1/carts/:userId`](#post-apiv1cartsuserId)
  - [`PUT api/v1/carts/:cartId`](#put-apiv1cartscartId)
  - [`GET api/v1/carts/:cartId`](#get-apiv1cartscartId)
  - [`DELETE api/v1/carts/:cartId`](#DELETE-apiv1cartscartId)
  - [`DELETE api/v1/carts/:cartId/buy`](#delete-apiv1cartscartIdbuy)


## Authentication

This API uses jwt for authentication, this means that once a user is logged in using the [login request](###`POST-api/v1/users/login`) the returned token must be included in **all** future requests as a header named `x-auth-token` or `Authorization`. Each time the user makes a request the token will de validated. If there is a problem with authentication user will receive a `HTTP 401 UNAUTHORIZED` error. Each generated token is valid for 1 hour after it's generation, past this time user will need to login again and will receive a new token.

## `api/v1/users` ðŸ‘¤

- ### `GET api/v1/users`

    Returns all users.

    | Query Param   | Type   | Required | Description | Example |
    | ------------- | ------ | :------: | ----------- | ------- |
    | `userType`        | String | No     | If you want to filter by a specific  user type, you can specify it | `api/v1/users?userType=admin`

    ```json
    HTTP 200 OK
    [
        {
            "id": "1",
            "name": "Sam Thompson",
            "email": "sam.thompson@example.com",
            "userType": "admin"
        },
        {
            "id": "2",
            "name": "Sara Perez",
            "email": "sara.perez@example.com",
            "userType": "customer"
        }
    ]
    ```

- ### `GET api/v1/users/:userId`

    Returns a specific user.

    | Request Param | Type   | Required | Description |
    | ------------- | ------ | :------: | ----------- |
    | `userId`        | String | Yes     | Id of the user |


    ```json
    Example api/v1/users/1
    HTTP 200 OK 
    {
        "id": "1",
        "name": "Sam Thompson",
        "email": "sam.thompson@example.com",
        "userType": "admin"
    }

    If user is not found
    HTTP 404 NOT FOUND
    {
        "error": "User with id {id} not found."
    }
    ```

- ### `PUT api/v1/users/:userId`

    Updates properties of given user and returns updated user.

    | Request Param | Type   | Required | Description |
    | ------------- | ------ | :------: | ----------- |
    | `userId`        | String | Yes     | Id of the user |

    Body should include properties to be updated. Properties that can be updated are: **name**, **email** and **password**

    Request body example:
    ```json
    {
        "email": "sam_thompson@example.com"
    }
    ```

    ```json
    Example api/v1/users/1
    HTTP 200 OK 
    {
        "id": "1",
        "name": "Sam Thompson",
        "email": "sam_thompson@example.com",
        "userType": "admin"
    }

    If user is not found
    HTTP 404 NOT FOUND
    {
        "error": "User with id {id} not found."
    }
    ```

- ### `POST api/v1/users/register`

    Registers a new user and returns created object along with it's `id` which is autogenerated when the new user is stored in the database.
    
    Body should include required properties. 
    ```json
    {
        "name": "John Doe",
        "email": "john.doe@example.com",
        "password": "hashedPassword",
        "userType": "customer",
    }
    ```
    ```json
    HTTP 200 OK
    {
        "id": "3",
        "name": "John Doe",
        "email": "john.doe@example.com",
        "userType": "customer"
    }

    If some part of the request body is invalid or missing
    HTTP 400 BAD REQUEST
    {
        "errors": "UserType must be admin or customer"
    }
    ```

- ### `POST api/v1/users/login`

    Logins a user validating email and password. If data is correct a jwt token will be generated and returned.
    
    Body should include required properties for signin and for the jwt payload. It's important to note that the hashed password will **not** be included in the jwt token.
    ```json
    {
        "iss": "fpavanClothingStore",
        "sub": "3",
        "email": "John Doe",
        "name": "john.doe@example.com",
        "password": "hashedPassword",
    }
    ```
    ```json
    HTTP 200 OK
    {
        "message": "Authentication successful!",
        "token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpZCI6MTIzNDU2Nzg5LCJuYW1lIjoiSm9zZXBoIn0.OpOSSw7e485LOP5PrzScxHb7SR6sAOMRckfFwi4rp7o"
    }

    If some part of the request body is invalid or missing
    HTTP 400 BAD REQUEST
    {
        "errors": "Request must include email and password along with jwt payload requirements: sub, iss, exp"
    }

    If email and/or password are incorrect
    HTTP 403 FORBIDDEN
    {
        "errors": "Incorrect email or password"
    }
    ```

- ### `DELETE api/v1/users/:userId` 

    Deletes a given user.

    | Request Param | Type   | Required | Description |
    | ------------- | ------ | :------: | ----------- |
    | `userId`        | String | Yes     | Id of the user | 

    ```json
    HTTP 204 NO CONTENT

    If user not found
    HTTP 404 NOT FOUND
    {
        "error": "User with id {id} not found."
    }
    ```

## `api/v1/products` ðŸ‘”

- ### `GET api/v1/products`

    Returns all products with available stock. Optionally different filters can be specified using query params.

    | Query Param   | Type   | Required | Description | Example |
    | ------------- | ------ | :------: | ----------- | ------- |
    | `category`        | String | No     | Product category, e.g. "Tops" | `api/v1/products?category=tops` |
    | `color` | String | No | Product color, e.g. "Red" |  `api/v1/products?color=red` | 
    | `size` | String | No | Product size, e.g "XXL" |  `api/v1/products?size=xxl` |
    | `priceMin` | Number | No | Minimum price, will return only products more expensive than it |  `api/v1/products?priceMin=3` |
    | `priceMax` | Number | No | Maximum price, will return only products cheaper than it |  `api/v1/products?priceMax=10` |

    These filters can be combined in any way, and multiple values are allowed for `category`, `color` and `size`.

    ```json
    HTTP 200 OK
    [
        {
            "id": "1",
            "category": ["tops", "t-shirts"],
            "price": 15,
            "options": {
                "pink": {
                    "s": 3,
                    "xl": 2
                }
            }
        },
        {
            "id": "2",
            "category": ["bottoms", "skirts"],
            "price": 20,
            "options": {
                "blue": {
                    "s": 1,
                    "m": 2
                },
                "purple": {
                    "xs": 6,
                    "l": 2
                }
            }
        },
        ...
    ]
    ```

- ### `GET api/v1/products/:productId`

    Returns a specific product.

    | Request Param | Type   | Required | Description |
    | ------------- | ------ | :------: | ----------- |
    | `productId`        | String | Yes     | Id of the product | 

    ```json
    Example api/v1/products/1
    HTTP 200 OK
    {
        "id": "1",
        "category": ["tops", "t-shirts"],
        "price": 15,
        "options": {
            "pink": {
                "s": 3,
                "xl": 2
            }
        }
    }

    If product not found
    HTTP 404 NOT FOUND
    {
        "errors": "product with id {id} not found"
    }
    ```

- ### `PUT api/v1/products/:productId`

    Updates a given product and returns updated version.

    | Request Param | Type   | Required | Description |
    | ------------- | ------ | :------: | ----------- |
    | `productId`        | String | Yes     | Id of the product | 

    Request body should include properties to be updated.
    Example:
    ```json
    {
        "price": 5
    }
    ```

    ```json
    HTTP 200 OK
    {
        "id": "1",
        "category": ["tops", "t-shirts"],
        "price": 5,
        "options": {
            "pink": {
                "s": 3,
                "xl": 2
            }
        }
    }

    If product not found
    HTTP 404 NOT FOUND
    {
        "errors": "product with id {id} not found"
    }
    ```

- ### `POST api/v1/products`

    Adds a new product and returns created item along with the `id` generated when the product is saved in the database.

    Request body should include required properties: id, category, price. Products can be created without options, which can be added later.
    Example:
    ```json
    {
        
        "category": ["dresses"],
        "price": 13
    }
    ```

    ```json
    HTTP 200 OK
    {
        "id": "3",
        "category": ["dresses"],
        "price": 13,
        "options": {}
    }

    If there is an issue with the request body
    HTTP 400 BAD REQUEST
    {
        "errors": "Product price is required"
    }
    ```

- ### `DELETE api/v1/products/:productId`

    Deletes a given product

    | Request Param | Type   | Required | Description |
    | ------------- | ------ | :------: | ----------- |
    | `productId`        | String | Yes     | Id of the product | 

    ```json
    HTTP 204 NO CONTENT

    If product not found
    HTTP 404 NOT FOUND
    {
        "error": "Product with id {id} not found."
    }
    ```

## `api/v1/products/:productId/options` ðŸ“ƒ

- ### `POST api/v1/products/:productId/options`

    Adds option to a given product. Returns product with new option added. If option color already exits for that product but size does not it adds the new size. If size already exists it adds given amount to existing size stock.

    | Request Param | Type   | Required | Description |
    | ------------- | ------ | :------: | ----------- |
    | `productId`        | String | Yes     | Id of the product | 

    Request body should include required properties:  color, size, stock.
    Example:
    ```
    {
        "red": {
            "s": 2
        }
    }
    ```

    ```json
    HTTP 200 OK
    {
        "id": "3",
        "category": ["dresses"],
        "price": 13,
        "options": {
            "red": {
                "s": 2
            }
        }
    }

    If the product is not found
    HTTP 404 BAD REQUEST
    {
        "errors": "Product not found"
    }
    ```

- ### `DELETE api/v1/products/:productId/options/:color`

    Deletes a given option from a product.

    | Request Param | Type   | Required | Description |
    | ------------- | ------ | :------: | ----------- |
    | `productId`        | String | Yes     | Id of the product | 
    | `color` | String | Yes | Color that identifies the option |

    Optionally size can be specified, in this case only given size will be deleted from the option, not the whole option. If there are no remaining sizes, the whole option will be deleted.

    | Query Param   | Type   | Required | Description | Example |
    | ------------- | ------ | :------: | ----------- | ------- |
    | `size`        | String | No     | Product option size, e.g. "xl" | `api/v1/products/3/options/red?size=xl` |

    ```json
    HTTP 204 NO CONTENT

    If product or option not found
    HTTP 404 NOT FOUND
    {
        "error": "Product with id {id} not found."
    }
    ```

## `api/v1/carts` ðŸ›’

- ### `POST api/v1/carts/:userId`

    Creates a cart for a given user. Returns created cart. A cart is initially created without products.

    | Request Param | Type   | Required | Description |
    | ------------- | ------ | :------: | ----------- |
    | `userId`        | String | Yes     | Id of the user | 

    ```json
    HTTP 200 OK
    {   
        "cartId": "1",
        "userId": "1",
        "products": []
    }

    If user not found
    HTTP 404 NOT FOUND
    {
        "error": "User with id {id} not found."
    }
    ```

- ### `PUT api/v1/carts/:cartId`

    Adds a product to a cart. Returns updated cart.
    | Request Param | Type   | Required | Description |
    | ------------- | ------ | :------: | ----------- |
    | `cartId`        | String | Yes     | Id of the cart | 

    Request body should include productId and option details (color, size, product amount). Example:
    ```json
    {
        "productId": "2",
        "blue": {
            "s": 1
        }
    }
    ```

    ```json
    HTTP 200 OK
    {
        "cartId": "1",
        "userId": "1",
        "products": [
            {
                "productId": "2",
                "blue": {
                    "s": 1
                }
            }
        ]
    }

    If cart not found
    HTTP 404 NOT FOUND
    {
        "error": "Cart with id {id} not found."
    }

    If there is an issue with the body (product not found, option doesn't exist,not enough stock)
    HTTP 400 BAD REQUEST
    {
        "error": "Not enough stock of product {productId} in color {optionColor}"
    }
    ```

- ### `GET api/v1/carts/:cartId`

    Returns a given cart.

    | Request Param | Type   | Required | Description |
    | ------------- | ------ | :------: | ----------- |
    | `cartId`        | String | Yes     | Id of the cart | 

    ```json
    HTTP 200 OK
    {
        "cartId": "1",
        "userId": "1",
        "products": [
            {
                "productId": "2",
                "blue": {
                    "s": 1
                }
            }
        ]
    }

    If cart not found
    HTTP 404 NOT FOUND
    {
        "error": "Cart with id {id} not found."
    }
    ```

- ### `DELETE api/v1/carts/:cartId`

    Deletes a given cart.

    | Request Param | Type   | Required | Description |
    | ------------- | ------ | :------: | ----------- |
    | `cartId`        | String | Yes     | Id of the cart |     

    ```json
    HTTP 204 NO CONTENT

    If cart not found
    HTTP 404 NOT FOUND
    {
        "error": "Cart with id {id} not found."
    }
    ```

- ### `DELETE api/v1/carts/:cartId/buy`

    Buys a cart. Subtracts stocks from inventory and deletes cart.
    
    | Request Param | Type   | Required | Description |
    | ------------- | ------ | :------: | ----------- |
    | `cartId`        | String | Yes     | Id of the cart |     

    ```json
    HTTP 204 NO CONTENT

    If cart not found
    HTTP 404 NOT FOUND
    {
        "error": "Cart with id {id} not found."
    }
    ```